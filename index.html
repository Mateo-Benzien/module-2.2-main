<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="styles.css">
    <title>SwiftCart â€” The fastest e-commerce store in SA</title>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body>
    <header x-data="navigation()">
        <div class="navbar">
            <div class="navbar-left">
                <h1>SwiftCart</h1>
            </div>
            <div class="navbar-right">
                <a href="/wishlist" class="nav-link">
                    <svg class="nav-icon wishlist" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                    </svg>
                    Wishlist
                </a>
                <a href="/cart" class="nav-link">
                    <svg class="nav-icon cart" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M7 4V2H2V4H5.28L5.88 6H19.12L19.72 4H22V2H17V4H14V2H9V4H7ZM5.28 8L4.68 10H19.32L18.72 8H5.28ZM2 22H20V20H2V22ZM17 18V20H5V18H17ZM21 12H16V16H21V12ZM3 12H8V16H3V12Z"/>
                    </svg>
                    Cart
                </a>
                <a href="/login" class="nav-link">
                    <svg class="nav-icon login" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM13 17h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                    </svg>
                    Login
                </a>
            </div>
        </div>
    </header>

    <main x-data="filterComponent()">
        <div class="controls">
            <div class="controls-inner">
                <!-- Categories Dropdown -->
                <div class="dropdown-container">
                    <label for="category" class="dropdown-label">Category:</label>
                    <select x-model="filterItem" @change="handleFilter(filterItem)" id="category" class="dropdown-select">
                        <option value="All categories">All categories</option>
                        <template x-for="category in categories" :key="category">
                            <option :value="category" x-text="category"></option>
                        </template>
                    </select>
                </div>

                <!-- Search Input -->
                <div class="search-container">
                    <input type="search" x-model="searchTerm" @input="handleSearch()" class="search-input" placeholder="Search products...">
                    <button type="button" @click="handleSearch()" class="search-button">
                        <svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"></path>
                        </svg>
                        <span class="sr-only">Search</span>
                    </button>
                </div>

                <!-- Sort Dropdown -->
                <div class="sort-container">
                    <label for="sort" class="sort-label">Sort by: </label>
                    <select x-model="selectedSortOrder" @change="applySorting()" id="sort" class="sort-select">
                        <option value="default">Default</option>
                        <option value="low">Price: Low to High</option>
                        <option value="high">Price: High to Low</option>
                    </select>
                </div>
            </div>
        </div>
        <!-- Product Gallery -->
        <div class="product-gallery">
            <template x-for="product in products" :key="product.id">
                <div class="product-item" @click="openModal(product)">
                    <img :src="product.image" :alt="product.title" class="product-img"/>
                    <h2 x-text="product.title" class="product-title"></h2>
                    <p x-text="product.description" class="product-desc"></p>
                    <p x-text="'$' + product.price" class="product-price"></p>
                </div>
            </template>
        </div>

        <!-- Modal -->
        <div x-show="isModalOpen" @click.away="closeModal()" class="modal-overlay">
            <div class="modal-content">
                <span @click="closeModal()" class="modal-close">&times;</span>
                <img :src="selectedProduct.image" :alt="selectedProduct.title" class="modal-img"/>
                <h2 x-text="selectedProduct.title" class="modal-title"></h2>
                <p x-text="selectedProduct.description" class="modal-desc"></p>
                <p x-text="'$' + selectedProduct.price" class="modal-price"></p>
                <p x-text="'Category: ' + selectedProduct.category" class="modal-category"></p>
                <p x-text="'Rating: ' + selectedProduct.rating" class="modal-rating"></p>
                <p x-text="'Reviews: ' + selectedProduct.reviews" class="modal-reviews"></p>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('filterComponent', () => ({
                categories: [],
                filterItem: 'All categories',
                searchTerm: '',
                products: [],
                selectedSortOrder: 'default',
                selectedProduct: {},
                isModalOpen: false,
                error: null,

                init() {
                    this.fetchCategories();
                    this.fetchProducts();
                },

                async fetchCategories() {
                    try {
                        const response = await fetch('https://fakestoreapi.com/products/categories');
                        this.categories = await response.json();
                    } catch (error) {
                        this.error = 'Failed to fetch categories';
                    }
                },

                async fetchProducts() {
                    let url = 'https://fakestoreapi.com/products';
                    if (this.filterItem && this.filterItem !== 'All categories') {
                        url += `/category/${this.filterItem}`;
                    }
                    if (this.searchTerm) {
                        url += `?q=${this.searchTerm}`;
                    }
                    try {
                        const response = await fetch(url);
                        this.products = await response.json();
                        this.applySorting();
                    } catch (error) {
                        this.error = 'Failed to fetch products';
                    }
                },

                handleFilter(category) {
                    this.filterItem = category;
                    this.fetchProducts();
                },

                handleSearch() {
                    this.fetchProducts();
                },

                applySorting() {
                    if (this.selectedSortOrder === 'default') {
                        return;
                    }
                    this.products.sort((a, b) => {
                        return this.selectedSortOrder === 'low' ? a.price - b.price : b.price - a.price;
                    });
                },

                openModal(product) {
                    this.selectedProduct = product;
                    this.isModalOpen = true;
                },

                closeModal() {
                    this.isModalOpen = false;
                }
            }));

            Alpine.data('navigation', () => ({
                // Navigation logic
            }));
        });
    </script>
</body>
</html>
